<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>統合記念愛唱NEXT STAGE</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<style>
html, body {
  margin:0;
  padding:0;
  height:100vh;
  width:100vw;
  background:#ccc;
  font-family:sans-serif;
  overflow:hidden;
}
#parentContainer {
  position:absolute;
  width:1920px;
  height:1080px;
  background:#fff;
  left:50%;
  top:50%;
  transform-origin:50% 50%;
}
#imageDisplay {
  position:absolute;
  top:0;
  left:0;
  width:1920px;
  height:985.5px;
  object-fit:contain;
  background:#fff;
  z-index:1;
}
#bottomBar {
  position:absolute;
  left:0;
  top:985.5px;
  width:1920px;
  height:94.5px;
  background:#9fdefd;
  z-index:0;
}
.btn {
  position:absolute;
  background:none;
  border:none;
  cursor:pointer;
  padding:0;
  z-index:5;
}
.btn img {
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

/* presetMenu */
#presetMenu {
  position:absolute;
  display:none;
  width:188px;
  height:158px;
  z-index:10;
}
#presetMenu img.menu-bg {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:5;
}
#presetMenu button {
  position:absolute;
  border:none;
  background:none;
  cursor:pointer;
  padding:0;
  z-index:15;
}
#presetMenu button img {
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

/* speedMenu */
#speedMenu {
  position:absolute;
  display:none;
  width:160px;
  height:134px;
  left:909.1px;
  top:875.3px;
  z-index:12;
}
#speedMenu img.menu-bg {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:2;
}
.speed-btn {
  position:absolute;
  width:74px;
  height:53px;
  border-radius:10px;
  overflow:hidden;
  box-sizing:border-box;
  z-index:5;
  cursor:pointer;
  transition:box-shadow .12s,border-color .12s;
}
.speed-btn.active {
  border:2px solid #ff3333;
  box-shadow:0 4px 10px rgba(255,50,50,0.12);
}
#btnSpeedToggle {
  left:909.1px;
  top:998.8px;
  width:160px;
  height:68px;
  z-index:13; /* メニューより前面にしてボタン出す */
}
</style>
</head>
<body>
<div id="parentContainer">
  <!-- 画像表示 -->
  <img id="imageDisplay" src="image/1.png" alt="表示画像">

  <!-- 下バー -->
  <div id="bottomBar"></div>

  <!-- 再生系ボタン -->
  <button id="btn1" class="btn" style="left:16.3px; top:997.6px; width:70px; height:70px;"><img src="image/back.svg" alt="戻る"></button>
  <button id="btn2" class="btn" style="left:104.2px; top:997.6px; width:70px; height:70px;"><img src="image/yarinaoshi.svg" alt="巻き戻すだけ"></button>
  <button id="btn3" class="btn" style="left:192.1px; top:997.6px; width:70px; height:70px;"><img src="image/stop.svg" alt="停止"></button>
  <button id="btn4" class="btn" style="left:280.0px; top:997.6px; width:70px; height:70px;"><img src="image/start.svg" alt="再生"></button>
  <button id="btn5" class="btn" style="left:367.9px; top:997.6px; width:159.2px; height:70px;"><img src="image/again.svg" alt="最初に戻して再生"></button>
  <button id="btn6" class="btn" style="left:545.0px; top:997.8px; width:170.8px; height:70px;"><img src="image/after_again.svg" alt="after_again"></button>
  <button id="btn7" class="btn" style="left:733.7px; top:997.6px; width:70px; height:70px;"><img src="image/maki.svg" alt="10秒巻き戻し"></button>
  <button id="btn8" class="btn" style="left:821.6px; top:997.6px; width:70px; height:70px;"><img src="image/oku.svg" alt="10秒送り"></button>

  <!-- preset -->
  <button id="btnPreset" class="btn" style="left:1717.3px; top:997.8px; width:188px; height:70px;"><img src="image/preset.svg" alt="プリセット"></button>
  <div id="presetMenu">
    <img src="image/preset_menu.svg" class="menu-bg">
    <button id="btnPreset1" style="top:4px; left:4px; width:180.3px; height:62.5px;"><img src="image/all.svg" alt="歌詞付き"></button>
    <button id="btnPreset2" style="top:70.9px; left:4px; width:180.3px; height:62.5px;"><img src="image/sounds_only.svg" alt="音声のみ"></button>
  </div>

  <!-- speed -->
  <button id="btnSpeedToggle" class="btn"><img src="image/speed_ajust.svg" alt="再生速度"></button>
  <div id="speedMenu">
    <img src="image/speed_ajust_menu.svg" class="menu-bg" alt="速度メニュー">
    <div id="speedBtn05" class="speed-btn" style="left:3.5px; top:3.4px;" data-rate="0.5"><img src="image/speed_05.svg" style="width:100%;height:100%;border-radius:10px;"></div>
    <div id="speedBtn08" class="speed-btn" style="left:82px; top:3.4px;" data-rate="0.8"><img src="image/speed_08.svg" style="width:100%;height:100%;border-radius:10px;"></div>
    <div id="speedBtn10" class="speed-btn" style="left:3.5px; top:59.8px;" data-rate="1.0"><img src="image/speed_10.svg" style="width:100%;height:100%;border-radius:10px;"></div>
    <div id="speedBtn12" class="speed-btn" style="left:82px; top:59.8px;" data-rate="1.2"><img src="image/speed_12.svg" style="width:100%;height:100%;border-radius:10px;"></div>
  </div>

  <audio id="audio" src="audio/sample.mp3"></audio>
</div>

<script>
// 既存再生処理
const audio=document.getElementById('audio');
const btn4=document.getElementById('btn4');
const btn4Img=btn4.querySelector('img');
const imageDisplay=document.getElementById('imageDisplay');
btn4.addEventListener('click',()=>{audio.paused?audio.play():audio.pause();});
audio.addEventListener('play',()=>{btn4Img.src="image/0.svg"; btn4Img.alt="一時停止";});
audio.addEventListener('pause',()=>{btn4Img.src="image/start.svg"; btn4Img.alt="再生";});

// 再生系ボタン
document.getElementById('btn1').addEventListener('click',()=>{});
document.getElementById('btn2').addEventListener('click',()=>{audio.currentTime=0;});
document.getElementById('btn3').addEventListener('click',()=>audio.pause());
document.getElementById('btn5').addEventListener('click',()=>{audio.currentTime=0;audio.play();});
document.getElementById('btn7').addEventListener('click',()=>audio.currentTime=Math.max(0,audio.currentTime-10));
document.getElementById('btn8').addEventListener('click',()=>audio.currentTime=Math.min(audio.duration,audio.currentTime+10));

// preset
const presetBtn=document.getElementById("btnPreset");
const presetMenu=document.getElementById("presetMenu");
let mode="ALL";
presetBtn.addEventListener("click",(e)=>{
  e.stopPropagation();
  presetMenu.style.display=(presetMenu.style.display==="block"?"none":"block");
  presetMenu.style.left=presetBtn.offsetLeft+"px";
  presetMenu.style.top=(presetBtn.offsetTop - presetMenu.offsetHeight)+"px";
});
document.getElementById("btnPreset1").addEventListener("click",()=>{
  mode="ALL"; imageDisplay.src="image/1.png"; presetMenu.style.display="none";
});
document.getElementById("btnPreset2").addEventListener("click",()=>{
  mode="SOUNDS_ONLY"; imageDisplay.src="image/sounds_only.png"; presetMenu.style.display="none";
});

// speedメニュー
const speedToggle=document.getElementById('btnSpeedToggle');
const speedMenu=document.getElementById('speedMenu');
audio.playbackRate=1.0;
document.getElementById('speedBtn10').classList.add('active');
speedToggle.addEventListener('click',(e)=>{
  e.stopPropagation();
  speedMenu.style.display=(speedMenu.style.display==="block"?"none":"block");
});

// speedボタン
function setPlaybackRate(rate,btnId){
  audio.playbackRate=rate;
  document.querySelectorAll('.speed-btn').forEach(el=>el.classList.remove('active'));
  document.getElementById(btnId).classList.add('active');
  speedMenu.style.display='none';
}
document.getElementById('speedBtn05').addEventListener('click',(e)=>{e.stopPropagation(); setPlaybackRate(0.5,'speedBtn05');});
document.getElementById('speedBtn08').addEventListener('click',(e)=>{e.stopPropagation(); setPlaybackRate(0.8,'speedBtn08');});
document.getElementById('speedBtn10').addEventListener('click',(e)=>{e.stopPropagation(); setPlaybackRate(1.0,'speedBtn10');});
document.getElementById('speedBtn12').addEventListener('click',(e)=>{e.stopPropagation(); setPlaybackRate(1.2,'speedBtn12');});

// 外クリックで閉じる
document.addEventListener('click',(e)=>{
  if(presetMenu.style.display==="block" && !presetMenu.contains(e.target) && !presetBtn.contains(e.target)) presetMenu.style.display="none";
  if(speedMenu.style.display==="block" && !speedMenu.contains(e.target) && !speedToggle.contains(e.target)) speedMenu.style.display="none";
});

// 画像切替
audio.addEventListener('timeupdate',()=>{
  if(mode==="ALL"){
    const currentSec=audio.currentTime;
    for(let i=imageTimes.length-1;i>=0;i--){
      const t=imageTimes[i].min*60+imageTimes[i].sec;
      if(currentSec>=t){
        if(imageDisplay.src.indexOf(imageTimes[i].src)===-1) imageDisplay.src=imageTimes[i].src;
        break;
      }
    }
  } else if(mode==="SOUNDS_ONLY"){
    if(imageDisplay.src.indexOf("sounds_only.png")===-1) imageDisplay.src="image/sounds_only.png";
  }
});

// リサイズ
function resizeContainer(){
  const vw=window.innerWidth;
  const vh=window.innerHeight;
  const baseW=1920, baseH=1080;
  const parent=document.getElementById('parentContainer');
  let scale=(vw/vh>baseW/baseH)?vh/baseH:vw/baseW;
  parent.style.transform=`translate(-50%,-50%) scale(${scale})`;
}
window.addEventListener('resize',resizeContainer);
window.addEventListener('load',resizeContainer);
</script>
</body>
</html>
